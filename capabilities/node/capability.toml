[capability]
id = "node"
name = "Node.js"
description = "Node.js runtime and npm package manager"

[packages]
system = ["nodejs"]
setup_script = """
#!/bin/bash
set -e
# Add NodeSource repository for Node.js 22.x (idempotent)

# Check if NodeSource repository is already configured
if grep -q "deb.nodesource.com" /etc/apt/sources.list.d/nodesource.list 2>/dev/null; then
    echo "NodeSource repository already configured"
else
    echo "Adding NodeSource repository..."
    # Download and execute official NodeSource setup script
    # Security: HTTPS (TLS) ensures authenticity via certificate validation
    # The script handles GPG key download and verification internally
    curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
    echo "âœ“ NodeSource repository configured"
fi
"""

[vm_runtime]
script = """
#!/bin/bash
# Write Node.js context for Claude
mkdir -p ~/.claude-vm/context
cat > ~/.claude-vm/context/node.txt <<EOF
Node.js version: $(node --version 2>/dev/null || echo "not available")
npm version: $(npm --version 2>/dev/null || echo "not available")
Global packages: $(npm list -g --depth=0 2>/dev/null | wc -l || echo "unknown")
EOF
"""
