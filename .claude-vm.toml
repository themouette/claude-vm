[tools]
git = true
gpg = true
gh = true
# Do not forward ssh agent, git interactions with remote repository should be
# done from host
# ssh = false

[setup]
# ADDITIONAL setup scripts (run during template creation)
# Standard scripts are auto-detected, no config needed:
#   - ~/.claude-vm.setup.sh (global)
#   - ./.claude-vm.setup.sh (project root)
scripts = []

[context]
# Load context
instructions = """
# Claude VM Project Context

This is the Claude VM project - a Rust CLI tool for running Claude Code in isolated Lima VMs.

## Architecture

- **Config system**: Layered precedence (CLI > env > project > global > defaults)
- **Capabilities**: Modular TOML-based system for tools (docker, node, python, etc.)
- **Runtime scripts**: Execute before each Claude session for environment setup
- **Context generation**: Automatic VM configuration context for Claude

## Key Components

- `src/config.rs`: Configuration loading and merging
- `src/capabilities/`: Capability definitions and registry
- `src/scripts/runner.rs`: Runtime script execution and context generation
- `src/vm/`: VM lifecycle management (Lima integration)

## Development Guidelines

- Include code examples when explaining functionality
- Follow Rust best practices and idioms
- Use proper error handling with Result types
- Test configuration merging and precedence
- Always run tests, format and clippy before creating a commit if rust code was changed
- create small and comprehensive commits to ease review. A commit should
  represent a logical step in the implementation.
- Before creating a commit, ensure that code is properly formatted and clippy checked.
- Before creating a commit, ensure that all tests are passing.
- Before creating or updating a pull request, ensure that the code is well-tested and
  that both CHANGELOG and documentation are up to date.


## Tools available

The setup script located in `bin/setup` should have been executed so you should
be able to access tools needed to run, compile and develop the project.
If something is missing, run this script again.

SSH agent is not available in the VM so you cannot interact with the remote
repository, but you can use `gh` to open and read pull requests or issues.

## Testing

To test behavior changes you can run the setup command with --no-agent-install.
You should also remove the gh capability to avoid having to login interactively.

With the new template you can run the shell command to check your changes.
"""

[security.network]
enabled = true
mode = "allowlist" # Block everything except allowed domains

# Domains to allow (for testing allowlist mode)
allowed_domains = [
  "api.anthropic.com",
  "*.github.com",         # Allow all GitHub subdomains
  "github.com",           # Allow github.com
  "static.rust-lang.org", # Rust installation
  "sh.rustup.rs",         # Rustup installation script
  "*.debian.org",         # Debian package repositories
  "deb.debian.org",       # Debian packages
  "cli.github.com",       # GitHub CLI

  # Required for development setup
  "*.fastly.net",                          # Fastly CDN (used by Debian mirrors)
  "debian.map.fastly.net",                 # Debian CDN
  "*.cloudflare.com",                      # Cloudflare CDN (used by various services)
  "*.rust-lang.org",                       # All Rust domains (not just static)
  "crates.io",                             # Rust package registry
  "*.crates.io",                           # Crates.io CDN
  "github-releases.githubusercontent.com", # GitHub releases
  "objects.githubusercontent.com",         # GitHub objects
  "raw.githubusercontent.com",             # GitHub raw content
]

# Domains that bypass the proxy (for certificate pinning issues)
bypass_domains = ["localhost", "127.0.0.1", "*.local"]

# Protocol blocking (recommended for security)
block_tcp_udp = true           # Block raw TCP/UDP connections
block_private_networks = true  # Block 10.0.0.0/8, 192.168.0.0/16, etc.
block_metadata_services = true # Block 169.254.169.254 (cloud metadata)
